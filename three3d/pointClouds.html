<head>
	<meta charset="utf-8">
</head>
<script src="three.min.js"></script>

<style>
	
	    body {
        color: #ffffff;
        font-family:Monospace;
        font-size:13px;
        text-align:center;
        font-weight: bold;

        background-color: #000000;
        margin: 0px;
        overflow: hidden;
    }
    
    #info {
        color: #fff;
        position: absolute;
        top: 0px; width: 100%;
        padding: 5px;
        z-index:100;
    }

</style>
<div id="container"></div>
<div id="info">点状云</div>
<script>
var renderer, scene, camera, stats;
			var pointclouds,geometry;
			var raycaster, intersects;
			var mouse = new THREE.Vector2();
			var intersection = null;
			var spheres = [];
			var spheresIndex = 0;
			var clock;

			var threshold = 0.5;
			var pointSize = 0.4;
			var width = 50;
			var length = 50;
			var rotateY = new THREE.Matrix4().makeRotationX( 0.005 );

			init();
			animate();

			function generateRegularPointcloud( color, width, length ) {

				 geometry = new THREE.Geometry();
				var numPoints = width * length;

				var colors = [];

				var k = 0;

				for( var i = 0; i < width; i++ ) {

					for( var j = 0; j < length; j++ ) {

						var u = i / width;
						var v = j / length;
						var x = u - 0.5;
						var y = 0;
						var z = v - 0.5;
						var v = new THREE.Vector3( x,y,z );

						var intensity = Math.random(0,( y + 0.1 ) * 8);
						colors[ 3 * k ] = color.r * intensity;
						colors[ 3 * k + 1 ] = color.g * intensity;
						colors[ 3 * k + 2 ] = color.b * intensity;

						geometry.vertices.push( v );
						//colors[ k ] = ( color.clone().multiplyScalar( intensity ) );
                        colors[ k ] = color.clone().setRGB(colors[ 3 * k ],colors[ 3 * k +1 ],colors[ 3 * k +2 ])
						k++;
						

					}

				}

				geometry.colors = colors;
				geometry.computeBoundingBox();

				var material = new THREE.PointCloudMaterial( { size: pointSize, vertexColors: THREE.VertexColors } );
				var pointcloud = new THREE.PointCloud( geometry, material );

				return pointcloud;

			}

			function init() {

				container = document.getElementById( 'container' );

				scene = new THREE.Scene();

				clock = new THREE.Clock();

				camera = new THREE.PerspectiveCamera( 33, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.applyMatrix( new THREE.Matrix4().makeTranslation( 0,0,15 ) );
				camera.applyMatrix( new THREE.Matrix4().makeRotationX( Math.PI/2 ) );


				var pcRegular = generateRegularPointcloud( new THREE.Color( 1,0,1 ), width, length );
				pcRegular.scale.set( 10,10,10 );
				pcRegular.position.set( 0,0,0 );
				scene.add( pcRegular );

				pointclouds = [ pcRegular ];

			
				//

				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );

				//

				raycaster = new THREE.Raycaster();
				raycaster.params.PointCloud.threshold = threshold;

				//

				// stats = new Stats();
				// stats.domElement.style.position = 'absolute';
				// stats.domElement.style.top = '0px';
				// container.appendChild( stats.domElement );

				//

				window.addEventListener( 'resize', onWindowResize, false );
				document.addEventListener( 'mousemove', onDocumentMouseMove, false );

			}

			function onDocumentMouseMove( event ) {

				event.preventDefault();

				mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				requestAnimationFrame( animate );

				render();
				// stats.update();

			}

			var toggle = 0;

			function render() {

				camera.applyMatrix( rotateY );
				camera.updateMatrixWorld();

				raycaster.setFromCamera( mouse, camera );

				toggle += clock.getDelta();

				renderer.render( scene, camera );

			}

			document.addEventListener('click',function(e){
         /*
				var i=Math.round(pointclouds[0].geometry.colors.length/4*Math.random());

				var r=Math.round(Math.random()*255),g=Math.round((Math.random()*255)),b=Math.round((Math.random()*255));
				
				
					var tmp=pointclouds[0].geometry.colors;
					
					tmp[i].set('rgb('+r+','+g+','+b+')');
					tmp[i+1].set('rgb('+r+','+g+','+b+')');
			    tmp[i+2].set('rgb('+r+','+g+','+b+')');
        pointclouds[0].geometry.colorsNeedUpdate=true;    */                                      
      })

</script>