<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="个人博客,web前端技术文章">
  <meta name="keywords" content="web前端,HTML5,CSS3,jQuery,Three.js" />
  <meta name="author" content="aboutqx" />
  <title>
    home
  </title>

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel=stylesheet href="css/base.css">
  <link rel="stylesheet" href="shared/css/base.css" />
  <style>
    div.startup {
      display: -webkit-box;
      display: -moz-box;
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
    }
    .main{
      display: -webkit-box;
      display: -moz-box;
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
      margin: auto;
      z-index:100;
      flex-wrap:wrap;
    }
    .main a{

      font-size:5em;

      text-shadow: 0px 0px 40px rgba(0, 191, 243, 0.6);
      color: #4183c4;
      font-family:  Helvetica, sans-serif;
    }

    .background-view{
      position: absolute;
      width: 100%;
      height:100%;
      left:0;
      top:0;
      color: rgba(255, 255, 255, 1.0);
    }
    .background-view .timestamp{
      
      position: absolute;
      left:80%;
      top:80%;
      font-family: Microsoft YaHei;
      font-size: 0.8em;
    }
    .view1{
      background: #000;
      
    }
    a:hover,a:active{
      text-decoration: none;
    }
    .main a:hover{
      -webkit-transform:rotateX(360deg);
      transform:rotateX(360deg);
    }
      .main a{
      transition: all 1.2s ease;
      -moz-transition: all 1.2s ease;  
      -webkit-transition: all 1.2s ease; 
      -o-transition: all 1.2s ease; 
    }
    .clip-wrap {
  vertical-align: top;
  padding: 0;
  margin: 0 ;
  -webkit-box-flex: 1 1 50%;
  -moz-box-flex: 1 1 50%;
  -webkit-flex: 1 1 50%;
  -ms-flex: 1 1 50%;
  flex:1 1 50%;
  text-align: center;
}

.controlmusic{
  position: absolute;
  left:85%;
  top:1%;
  cursor: pointer;
}
  </style>


</head>
<body>
<div class="background-view view1"> </div>
<div class="startup background-view">
  <div class="main">

  <div class="codeclip clip-wrap"><a href="codeAndDemo.html">code</a></div>
<div class="blogclip clip-wrap"><a href="techBlog.html">blog</a></div>
<div class="hackclip clip-wrap"><a href="hack.html">hack</a></div>
<div class="movieclip clip-wrap"><a href="movie.html">movie</a></div>
    
  </div>
 
</div>
<div class="background-view">

<span class="timestamp">first visited: </span>
<span class="controlmusic">stop music</span>
</div>

<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?14477adbfac6547eb550adaea5cc3d48";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();


function getStorage(){
  var span=document.querySelector('.timestamp'),delta=0;

  if(!localStorage.getItem('timestamp')) {
    localStorage.setItem('timestamp', (new Date()).getTime());
    span.innerHTML+="just now"
  } else {
    delta = ((new Date()).getTime() - (new Date()).setTime(localStorage.getItem('timestamp'))) / 1000;
    span.innerHTML+=switchToTime(delta);
    //span.innerHTML+=Math.floor(delta)+'s ago';
  }
}
function switchToTime(second){
  var tmp,suffix=' ago',units=['s','min','hour','day','month','year'],multiple=[1,60,60*60,60*60*24,60*60*24*30,60*60*24*360],
  limits=[60,60,24,30,12,100],result;
  
  for(var i=0;i<multiple.length;i++){
    tmp=second/multiple[i];
    
    if(tmp<limits[i]){
      tmp=Math.floor(tmp);
      if(tmp==1||i==0) {
        suffix=units[i]+suffix;
        result=tmp+suffix;
        break;
      }
      else {
        suffix=units[i]+'s'+suffix;
        result=tmp+suffix;
        break;
      } 
    } 
  }
  return result;
}
getStorage();
var defaultaduiomgr;
  function loadBuffer(url){

    var request = new XMLHttpRequest();
    request.open("GET", url, true);
    request.responseType = "arraybuffer";


    request.onload = function() {
      defaultaduiomgr=new audioMgr();
      defaultaduiomgr.play(request.response);

    }

    request.onerror = function() {
      alert('BufferLoader: XHR error');
    }

    request.send();

  }

  var audioMgr=function() {
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    this.context = new AudioContext();
    this.source=this.context.createBufferSource();

  }
  audioMgr.prototype.play=function(arrayBuffer){
    var self=this;
    this.context.decodeAudioData(
            arrayBuffer,
            function(buffer) {
              if (!buffer) {
                alert('error decoding file data: ' + url);
                return;
              }
              self.buffer=buffer;
              self.source.buffer = buffer;

              self.source.connect(self.context.destination);
              self.source.loop = true;
              self.source.start(0);
            },
            function(error) {
              console.error('decodeAudioData error', error);
            }
    );

  }
  audioMgr.prototype.stop=function(){
    this.source.stop(0);
  }
  audioMgr.prototype.start=function() {
    this.source=this.context.createBufferSource();
    this.source.buffer = this.buffer;
    this.source.connect(this.context.destination);
    this.source.loop = true;
    this.source.start(0);
  }
  
  if(!localStorage.getItem('musicPrefer')||localStorage.getItem('musicPrefer')=='yes')
    loadBuffer('0.mp3')
  else document.querySelector('.controlmusic').innerHTML='play music'
    
document.querySelector('.controlmusic').addEventListener('click',function(){
  if(this.innerHTML=='stop music'){
    defaultaduiomgr.stop();
    this.innerHTML='play music';
    
    localStorage.setItem('musicPrefer','no')
  } else {
    if(!defaultaduiomgr) loadBuffer('0.mp3')
     else defaultaduiomgr.start();
    this.innerHTML='stop music';
    
    localStorage.setItem('musicPrefer','yes')
  }
})


</script>



</body>
</html>